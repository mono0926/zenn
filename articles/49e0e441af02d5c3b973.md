---
title: "Firebase Remote Config ã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒ çµŒç”±ã§æ›´æ–°ã™ã‚‹"
emoji: "ğŸ”¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Firebase", "Node.js", "TypeScript", "Remote Config", "adminsdk"]
published: true
---

# Firebase Remote Config ã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒ çµŒç”±ã§æ›´æ–°ã—ãŸã„ç†ç”±

ç°¡å˜ã«ã‚¢ãƒ—ãƒªã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã›ãšã«è¨­å®šå€¤ãªã©ã‚’å¾Œã‹ã‚‰å¤‰æ›´ã§ãã¦ä¾¿åˆ©ãª[Remote Config](https://firebase.google.com/docs/remote-config)ã§ã™ãŒã€Firebase Webã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§æ‰‹å‹•ã§è¨­å®šã™ã‚‹ã“ã¨ãŒå¤šã„ã¨æ€ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/183s3dmd6sox68eut5pc1qrgj0mo)

ã—ã‹ã—ã€ã“ã®å ´åˆã€åŒä¸€ã‚¢ãƒ—ãƒªã‚’ç’°å¢ƒã”ã¨ã«Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ†ã‘ã¦ã„ã‚‹æ™‚ã«åŒã˜è¨­å®šã‚’ãã‚Œã‚‰è¤‡æ•°ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«é©ç”¨ã•ã›ã‚‹ã®ãŒé¢å€’ã‹ã¤ãƒŸã‚¹ã™ã‚‹ãƒªã‚¹ã‚¯ã‚‚ã‚ã‚Šã¾ã™ã€‚

ãã®ãŸã‚ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ çµŒç”±ã§é©ç”¨ã•ã›ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã¨ä¾¿åˆ©ã§ã™ã€‚
ä»¥å‰ã¯[REST API](https://firebase.google.com/docs/reference/remote-config/rest)ã—ã‹ç„¡ãã¦å°‘ã—é¢å€’ã§ã—ãŸãŒã€æœ€è¿‘Admin SDKã§ã‚‚æ“ä½œã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‚Šã§ã‚ˆã‚Šç°¡å˜ã«çµ„ã‚ã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ãã®ã‚„ã‚Šæ–¹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚
[The Firebase Blog: Manage your Remote Config templates from the Admin Node.js SDK](https://firebase.googleblog.com/2020/08/manage-remoteconfig-admin-nodejs-sdk.html)

# åˆã‚ã¯æ‰‹å‹•ã§è¨­å®šã—ã¦Publish

ã¨ã‚Šã‚ãˆãšã€Firebase Webã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸Šã®æ“ä½œã§è²¼ã£ãŸç”»åƒã®ã‚ˆã†ã«ã—ã¦Publishã—ã¾ã™ã€‚

# Publishæ¸ˆã¿ã®Remote Configã®JSONã‚’å–å¾—

Firebase CLIã‚’ä½¿ã†ã¨ç°¡å˜ã«ç¾åœ¨Publishã•ã‚Œã¦ã„ã‚‹Remote Configã®JSONã‚’å–å¾—ã§ãã¾ã™ã€‚

```sh
firebase remoteconfig:get --output remoteConfig.json
```

`remoteConfig.json`:

```json
{
  "parameterGroups": {
    "mono": {
      "parameters": {
        "foo": {
          "defaultValue": {
            "value": "bar"
          }
        }
      }
    }
  }
}
```

# è¨­å®šå€¤ã‚’å¤‰æ›´ã—ã¦ã¿ã‚‹

ãã®ã¾ã¾ä»–ã®Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«é©ç”¨ã—ãŸã„ã ã‘ãªã‚‰å¤‰æ›´æ“ä½œã¯ä¸è¦ã§ã™ãŒã€ãã¡ã‚“ã¨åæ˜ ã•ã‚Œã‚‹ã‹ã®ç¢ºèªã‚‚å…¼ã­ã¦ã€ä»Šå›ã¯å€¤ã‚’`bar`ã‹ã‚‰`bar2`ã«å¤‰æ›´ã—ã¦ã¿ã¾ã™ã€‚

```json
{
  "parameterGroups": {
    "mono": {
      "parameters": {
        "foo": {
          "defaultValue": {
            "value": "bar2"
          }
        }
      }
    }
  }
}
```

# ãƒ‡ãƒ—ãƒ­ã‚¤

`functions/src/script/remoteConfig.ts`ã‚ãŸã‚Šã«ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç½®ãã¾ã™ã€‚

```ts
import * as admin from 'firebase-admin'
import * as fs from 'fs'
import * as util from 'util'

export async function publish() {
  admin.initializeApp()

  const config = admin.remoteConfig()
  var currentTemplate = await config.getTemplate()

  const templateJson = {
    ...JSON.parse(fs.readFileSync('remoteConfig.json', 'utf8')),
    // æ›´æ–°æ“ä½œã«å¿…è¦
    etag: currentTemplate.etag,
  }
  config.publishTemplate(
    config.createTemplateFromJSON(JSON.stringify(templateJson))
  )
  console.log(util.inspect(templateJson, { depth: null }))
}
```

ã–ã£ãã‚Šæ¬¡ã®ã‚ˆã†ãªæµã‚Œã§ã™ã€‚

1. ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—ã—ã¦`etag`ã‚’å¾—ã‚‹
2. ä¸Šã§ç”¨æ„ã—ãŸ`remoteConfig.json`ã«ã€æ›´æ–°æ“ä½œã«å¿…è¦ãª`etag`ã‚’è¨­å®š
3. ãƒ‡ãƒ—ãƒ­ã‚¤

å®Ÿè¡Œã®ä»•æ–¹ã¯è‰²ã€…ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€`tsc`ã§ãƒ“ãƒ«ãƒ‰ã—ã¦ã€`node -e 'require("./lib/script/remoteConfig").publish()'`ãªã©ãŒãŠæ‰‹è»½ã§ã™ã€‚

åˆã‚ã¯Firebase CLIã ã‘ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§ã§ãã‚‹ã®ã‹ãªã¨æœŸå¾…ã—ã¦ã¾ã—ãŸãŒã€Admin SDKã§ã®æ“ä½œãŒå¿…è¦ã§ã—ãŸã€‚ä¸Šè¨˜ã®é€šã‚Šã€`etag`ã®è¨­å®šãŒå¿…è¦ã§ãã‚Œã¯CLIæ“ä½œã ã¨å³ã—ã„ã‹ã‚‰ã‹ãªã¨æƒ³åƒã—ã¦ã„ã¾ã™ã€‚

ç¢ºèªã™ã‚‹ã¨ã€`bar2`ã«å¤‰ã‚ã‚Šã¾ã—ãŸğŸ‰

![](https://storage.googleapis.com/zenn-user-upload/0mt0l9zyqajzn1y3jegsa6t7m2ns)

ãƒãƒãƒãƒæ‰‹ä½œæ¥­ã›ãšã«æ¸ˆã‚€ã‚ˆã†ã«ãªã£ã¦è‰¯ã‹ã£ãŸã§ã™ã­ğŸ¶
